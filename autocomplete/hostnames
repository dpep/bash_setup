# autocomplete ssh and scp with known hostnames

# known hosts
hostnames=(`perl -lne 'print $1 if /^([a-z0-9.]+),/' ~/.ssh/known_hosts | grep -i [a-z]\{3,\}`)

# ssh config
hostnames+=(`perl -lne 'print $1 if /^Host\s+([a-z0-9.]+)/' ~/.ssh/config`)

# sort and dedup
hostnames=`printf '%s\n' ${hostnames[@]} | sort -u`

# enable autocomplete
complete -W "${hostnames[@]}" ssh
complete -W "${hostnames[@]}" scp

# tidy up
unset hostnames
