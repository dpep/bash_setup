# Make movement easier, eg.
# `c path/to/dir/like/normal/cd`
# `c path/to/file/also/work`
# `c [`  # cd a separate shell into the same dir
# `c -1`  # go back to the last dir you were in, like popd


function c() {
  local DIR="$*"

  if [[ $DIR == "[" || $DIR == "]" ]]; then
    # go to current working dir
    cd `tail -n1 $history_file`
  elif [[ $DIR == '-1' ]]; then
    # go back to last visited dir
    cd `tail -n2 $history_file | head -n1`
  elif [ -f $DIR ]; then
    # specified a file, go to the containing directory
    cd `dirname $DIR`
  else
    cd $DIR
  fi

  export CWD=`pwd`

  if [ -n "$HISTSIZE" ]; then
    local history_file=~/.cd_history

    # update and truncate history file
    if [[ "$CWD" != `tail -n1 $history_file` ]]; then
      # not a duplicate
      echo $CWD >> "$history_file"
    fi

    if [[ `wc -l < $history_file` -gt $HISTSIZE ]]; then
      sed -i "1 d" $history_file
    fi
  fi

  ls
}


# autocomplete with available directories, respecting filter
complete -d -X "*@(`echo $DIGNORE | tr ':' '|'`)" -o default c
